# フローキャプチャツールの使用手順

## 概要

中継機接続フローを自動的にブラウザで操作し、各画面のスクリーンショットを撮影するツールです。

## 実行手順

### ステップ1: アプリケーションをビルド

```bash
npm run build
```

### ステップ2: プレビューサーバーを起動

**新しいターミナルを開いて**以下を実行：

```bash
npm run preview
```

✅ サーバーが起動したことを確認（`https://localhost:4173/support-flow` が表示される）

**重要**: プレビューサーバーは **HTTPS** で起動します。

### ステップ3: 接続テスト（オプション）

問題がある場合は、まず接続テストを実行：

```bash
npm run test-connection
```

### ステップ4: キャプチャプログラムを実行

**元のターミナルで**以下を実行：

```bash
npm run capture
```

### ステップ5: 結果を確認

`screenshots/` フォルダに29枚の画像が保存されます。

## 撮影される画面一覧

### 基本フロー（1-21）
1. トップページ
2. 設定方法選択
3. 製品入力
4. 製品確認
5. 利用方法選択
6. 中継機選択
7. 中継機設定開始
8. 準備画面
9-12. 設定ステップ1-4
13-17. WPS接続フロー
18. 設定完了
19-20. NPS入力
21. 最終完了

### マニュアル接続フロー（22-27）
22-27. WPSボタンがない場合の手動設定フロー

### エラーケース（28-29）
28. 再試行画面
29. サポート連絡画面

## カスタマイズ

`scripts/capture-flow.ts` を編集して以下をカスタマイズできます：

- **ブラウザ表示**: `headless: false` → `headless: true` で非表示に
- **画面サイズ**: `viewport: { width: 1280, height: 800 }`
- **待機時間**: `wait(1000)` の数値を変更（ミリ秒）
- **製品型番**: `'WXR-6000AX12S'` を変更
- **NPSスコア**: `'9'` を変更

## トラブルシューティング

### エラー: ERR_CONNECTION_REFUSED

**原因**: プレビューサーバーが起動していません

**解決策**: 
1. 別のターミナルで `npm run preview` を実行
2. ブラウザで `https://localhost:4173/support-flow` にアクセスできることを確認
   - 自己署名証明書の警告が出る場合は「続行」をクリック
3. 再度 `npm run capture` を実行

### エラー: HTTPS証明書エラー

**原因**: 自己署名証明書を使用しているため

**解決策**: 
- スクリプト内で `ignoreHTTPSErrors: true` が設定されているため、自動的に無視されます
- 手動でブラウザテストする場合は証明書警告を承認してください

### エラー: 要素が見つからない

**原因**: ページの読み込みが遅い、またはUIが変更された

**解決策**:
1. `wait()` の時間を増やす（例: `wait(2000)`）
2. セレクターを確認・修正
3. `waitUntil: 'networkidle'` オプションが適切に動作しているか確認

### スクリーンショットが途中で止まる

**原因**: JavaScriptエラーまたはタイムアウト

**解決策**:
1. ブラウザのコンソールでエラーを確認
2. プレビューサーバーを再起動
3. キャッシュをクリア

## 実行例

```bash
# ターミナル1
npm run build
npm run preview

# ターミナル2（新しいウィンドウ/タブで開く）
npm run capture
```

実行中、Chromiumブラウザが自動的に開き、フローを操作する様子が表示されます。
すべての操作が完了すると、ブラウザは自動的に閉じます。
